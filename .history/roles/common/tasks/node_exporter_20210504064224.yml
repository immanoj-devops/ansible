- name: Get node_exporter directory is there or not
  ansible.builtin.stat:
    path: /opt/node_exporter
  register: sym

- name: Grep the node_expirter version  
  shell: curl -s https://github.com/prometheus/node_exporter/releases | grep css-truncate-target | grep '<span class'  | head -1 | sed s/\</\ /g |sed s/\>/\ /g  | xargs | awk '{print $(NF-1)}' | | sed 's/v//'
  register: VERSION 

- name: Download the node exporter 
  when: sym.stat.isdir is not defined
  unarchive: 
     src: "https://github.com/prometheus/node_exporter/releases/download/v{{ VERSION.stdout }}/node_exporter-1.1.2.darwin-amd64.tar.gz"